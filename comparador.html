<!doctype html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comparador de Productos | IT HYT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

    <style>
        :root {
            --color-primary: #000000;
            --color-secondary: #ffffff;
            --color-accent: #5e35b1;
            --color-light-gray: #f5f5f5;
            --color-text-dark: #333333;
            --color-success: #25d366;
            --color-danger: #f44336;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--color-light-gray);
            color: var(--color-text-dark);
        }

        a {
            text-decoration: none;
            color: var(--color-secondary);
        }

        .top-banner {
            background: var(--color-primary);
            color: var(--color-secondary);
            text-align: center;
            padding: 5px 0;
            font-size: 0.8em;
        }

        .navbar-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--color-primary);
            padding: 10px 20px;
            flex-wrap: wrap;
        }

        .navbar-main .logo {
            color: var(--color-secondary);
            font-size: 1.5em;
            font-weight: bold;
            flex-shrink: 0;
        }

        .menu-toggle {
            display: none;
            color: var(--color-secondary);
            font-size: 1.5em;
            cursor: pointer;
            margin-left: 20px;
        }

        .navbar-search {
            flex-grow: 1;
            max-width: 500px;
            display: flex;
            margin: 0 20px;
        }

        .navbar-search input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px 0 0 4px;
        }

        .navbar-search-btn {
            background: var(--color-accent);
            color: var(--color-secondary);
            border: none;
            cursor: pointer;
            transition: 0.2s;
            padding: 10px 15px;
            border-radius: 0 4px 4px 0;
        }

        .navbar-search-btn:hover {
            background: #4b298c;
        }

        .navbar-icons {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-shrink: 0;
        }

        .navbar-icons a {
            margin-left: 20px;
            font-size: 1em;
            display: inline-block;
            color: var(--color-secondary);
            white-space: nowrap;
        }

        .navbar-icons a i {
            margin-right: 5px;
        }

        #comparison-counter {
            color: var(--color-success);
            font-weight: bold;
            margin-left: 5px;
        }

        .navbar-menu {
            background: var(--color-accent);
            display: flex;
            justify-content: flex-start;
            padding: 10px 20px;
            font-weight: bold;
        }

        .navbar-menu a {
            color: var(--color-secondary);
            padding: 0 15px;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .navbar-menu .right-link {
            margin-left: auto;
        }

        .product-page-container {
            max-width: 1300px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .product-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .product-header h1 {
            color: var(--color-primary);
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .product-header .sku {
            color: #777;
            font-size: 1.1em;
            margin-bottom: 30px;
            display: block;
        }

        .comparison-controls {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            border: none;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .btn-danger {
            background: var(--color-danger);
            color: var(--color-secondary);
        }

        .btn-like {
            background: var(--color-accent);
            color: var(--color-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-like.saved {
            filter: brightness(0.9);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #222;
        }

        .comparison-section {
            background: var(--color-secondary);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 30px 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.95em;
            table-layout: fixed;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px 5px;
            text-align: center;
            border-right: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th:last-child,
        .comparison-table td:last-child {
            border-right: none;
        }

        .comparison-table thead th {
            background: var(--color-primary);
            color: var(--color-secondary);
            font-weight: bold;
            font-size: 1em;
            text-transform: uppercase;
            padding: 15px 5px;
        }

        .comparison-table .feature-cell {
            text-align: left;
            font-weight: bold;
            background: var(--color-light-gray);
            color: var(--color-primary);
            border-right: 1px solid #ddd;
            width: 180px;
        }

        .comparison-table .product-title {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--color-accent);
        }

        .comparison-table .price-cell {
            font-weight: bold;
            font-size: 1.4em;
            color: var(--color-primary);
        }

        .comparison-table .buy-link a {
            background: var(--color-accent);
            color: var(--color-secondary);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9em;
            display: inline-block;
            transition: 0.2s;
        }

        .comparison-table .buy-link a:hover {
            background: #4b298c;
        }

        /* Historial de comparaciones guardadas */
        .saved-comparisons {
            margin-top: 32px;
        }

        .saved-comparisons h2 {
            margin: 8px 0 16px;
        }

        .saved-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 14px;
        }

        .saved-card {
            background: var(--color-secondary);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .saved-card .meta {
            font-size: 0.85em;
            color: #666;
        }

        .saved-card .names {
            font-size: 0.9em;
            color: #333;
            line-height: 1.25;
            min-height: 2.5em;
        }

        .saved-card .actions {
            display: flex;
            gap: 8px;
        }

        .saved-card .actions .btn {
            flex: 1;
        }

        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 40px;
            right: 40px;
            background: var(--color-success);
            color: var(--color-secondary);
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 3px #999;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @media (max-width: 992px) {
            .navbar-search {
                margin: 10px 0;
                order: 3;
                width: 100%;
                max-width: none;
                flex-basis: 100%;
            }

            .navbar-menu {
                flex-direction: column;
                display: none;
                padding: 10px 20px;
                position: absolute;
                width: 100%;
                box-shadow: 0 4px 5px rgba(0, 0, 0, 0.2);
                z-index: 999;
                top: 90px;
            }

            .navbar-menu.open {
                display: flex;
            }

            .menu-toggle {
                display: block;
            }

            .comparison-section {
                overflow-x: auto;
            }

            .comparison-table {
                width: 900px;
                table-layout: auto;
            }
        }

        @media (max-width: 768px) {
            .navbar-icons a {
                font-size: 0;
                padding-right: 0;
                margin-left: 10px;
            }

            .navbar-icons a i {
                font-size: 1.2em;
                margin-right: 0;
            }

            .navbar-icons .comp-link,
            .navbar-icons a:last-child {
                font-size: 1em;
            }

            .comparison-table {
                width: 700px;
            }

            .comparison-table .feature-cell {
                width: 120px;
                font-size: 0.9em;
            }
        }

        /* Popup reutilizado */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
        }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--color-secondary);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 2001;
            width: 90%;
            max-width: 450px;
            text-align: center;
        }

        .popup-overlay.show,
        .popup.show {
            display: block;
        }

        .popup h3 {
            margin-top: 0;
            color: var(--color-accent);
            font-size: 1.8em;
        }

        .popup p {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .popup .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            color: #888;
            cursor: pointer;
        }

        .popup .popup-btn {
            background: var(--color-accent);
            color: var(--color-secondary);
            padding: 12px 25px;
            border-radius: 5px;
            font-weight: bold;
            text-transform: uppercase;
            transition: 0.2s;
            display: inline-block;
        }

        .popup .popup-btn:hover {
            background: #4b298c;
        }
    </style>
</head>

<body onload="loadComparisonTable()">
    <header>
        <div class="top-banner">
            Compras a partir de $600.000 envío GRATIS a CABA y GBA
        </div>
        <div class="navbar-main">
            <a href="index.html" class="logo">IT HYT</a>

            <div class="navbar-icons">
                <a href="#" class="menu-toggle"><i class="fas fa-bars"></i></a>

                <a href="#"><i class="fas fa-user"></i> INGRESAR</a>
                <a href="#"><i class="fas fa-heart"></i> FAVORITOS</a>
                <a href="comparador.html" class="comp-link"><i class="fas fa-columns"></i> COMPARAR<span
                        id="comparison-counter"></span></a>
                <a href="#"><i class="fas fa-shopping-cart"></i> CARRITO</a>
            </div>
            <div class="navbar-search">
                <input type="text" placeholder="Busca productos (ej: iPhone, Notebook HP)..." />
                <button class="navbar-search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <nav class="navbar-menu" id="main-menu">
            <a href="#">CATEGORÍAS <i class="fas fa-caret-down"></i></a>
            <a href="#">OPORTUNIDADES</a>
            <a href="faq.html">PREGUNTAS FRECUENTES</a>
            <a href="#" class="right-link">VENDE NUESTRAS MARCAS</a>
        </nav>
    </header>

    <main class="product-page-container">
        <div class="product-header">
            <h1>Comparador de Productos Seleccionados</h1>
            <span class="sku">Compara hasta 4 productos de nuestro catálogo side-by-side</span>
        </div>

        <div class="comparison-controls">
            <button id="save-comparison-btn" class="btn btn-like" title="Guardar esta comparación">
                <i class="fas fa-heart"></i> Guardar comparación
            </button>
            <button id="comparison-clear-btn" class="btn btn-danger" onclick="clearComparison()">
                <i class="fas fa-times-circle"></i> Limpiar Comparación
            </button>
        </div>

        <section class="comparison-section">
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Características</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <!-- HISTORIAL -->
        <section class="saved-comparisons" id="saved-comparisons">
            <h2>Comparaciones guardadas</h2>
            <div class="saved-grid" id="saved-grid"></div>

            <div id="saved-empty" class="saved-empty msg" style="color: #666; padding: 10px 2px">
                No hay comparaciones guardadas todavía.
            </div>
        </section>
    </main>

    <a href="https://wa.me/" class="whatsapp-float" target="_blank"><i class="fab fa-whatsapp"></i></a>

    <!-- Popup de carrito (reutilizado del home) -->

    <div id="cart-popup-overlay" class="popup-overlay"></div>
    <div id="cart-popup" class="popup">
        <button id="close-popup-btn" class="close-btn">&times;</button>
        <h3>¡Recordatorio!</h3>
        <p>
            Tenés cosas pendientes en el carrito esperándote, ¡no las abandones!
        </p>
        <a href="#" class="popup-btn">Ir al Carrito</a>
    </div>

    <script>
        /* ===========================
         Datos de productos (mock)
         =========================== */
        function getProductData(productId) {
            const productDatabase = {
                "prod-001": {
                    name: 'Monitor UltraWide 34"',
                    price: "$589.999",
                    processor: "N/A",
                    ram: "N/A",
                    storage: "3440x1440 / 144Hz",
                },
                "prod-002": {
                    name: "Teclado Mecánico RGB Pro",
                    price: "$45.500",
                    processor: "Switches Brown Táctil",
                    ram: "Anti-Ghosting",
                    storage: "Full RGB",
                },
                "prod-003": {
                    name: "Webcam 4K con Autoenfoque",
                    price: "$85.000",
                    processor: "Sensor CMOS 8MP",
                    ram: "N/A",
                    storage: "4K/30fps, Auto Focus",
                },
                "prod-004": {
                    name: "Mouse Ergonómico Inalámbrico",
                    price: "$19.999",
                    processor: "Sensor Óptico",
                    ram: "N/A",
                    storage: "8000 DPI",
                },
                "prod-005": {
                    name: "Mousepad Gamer XL",
                    price: "$12.500",
                    processor: "Base Goma Antideslizante",
                    ram: "N/A",
                    storage: "900mm x 400mm",
                },
                "prod-006": {
                    name: "Auriculares Inalámbricos Gaming",
                    price: "$95.999",
                    processor: "Driver 50mm Neodimio",
                    ram: "Bluetooth 5.0 + 2.4GHz",
                    storage: "Micrófono Removible",
                },
                "prod-007": {
                    name: "Mouse Logitech MX Master 3S",
                    price: "$49.999",
                    processor: "Sensor Darkfield",
                    ram: "Flow Multi-Device",
                    storage: "8000 DPI / USB-C",
                },
            };
            return productDatabase[productId] || null;
        }

        /* ===========================
         Utilidades LocalStorage
         =========================== */
        const LS_KEYS = {
            CURRENT: "comparisonProducts",
            SAVED: "savedComparisons", // array de objetos {id, productIds[], createdAt}
        };

        function getCurrentComparison() {
            return JSON.parse(localStorage.getItem(LS_KEYS.CURRENT) || "[]");
        }
        function setCurrentComparison(ids) {
            localStorage.setItem(LS_KEYS.CURRENT, JSON.stringify(ids));
        }

        function getSavedComparisons() {
            return JSON.parse(localStorage.getItem(LS_KEYS.SAVED) || "[]");
        }
        function setSavedComparisons(list) {
            localStorage.setItem(LS_KEYS.SAVED, JSON.stringify(list));
        }

        // Normaliza arrays para detectar duplicados (independiente del orden)
        function normalizedKey(ids) {
            return [...new Set(ids)].sort().join("|");
        }

        /* ===========================
         UI: Comparación actual
         =========================== */
        function updateComparisonCounter(count) {
            const counter = document.getElementById("comparison-counter");
            if (counter) {
                counter.textContent = count > 0 ? ` (${count})` : "";
            }
        }

        function clearComparison() {
            localStorage.removeItem(LS_KEYS.CURRENT);
            loadComparisonTable();
            updateComparisonCounter(0);
            document
                .getElementById("save-comparison-btn")
                .classList.remove("saved");
        }

        function loadComparisonTable() {
            const productIds = getCurrentComparison();
            const products = productIds
                .map((id) => getProductData(id))
                .filter(Boolean);

            const tableBody = document.querySelector(".comparison-table tbody");
            const tableHeadRow = document.querySelector(
                ".comparison-table thead tr",
            );
            const clearButton = document.getElementById("comparison-clear-btn");

            const saveBtn = document.getElementById("save-comparison-btn");

            tableBody.innerHTML = "";

            tableHeadRow.innerHTML = "<th>Características</th>";

            if (products.length === 0) {
                tableBody.innerHTML =
                    '<tr><td class="feature-cell" colspan="5" style="text-align:center; padding: 50px;">No has seleccionado productos para comparar. Ve a la <a href="index.html" style="color:var(--color-accent);">página de inicio</a> para empezar.</td></tr>';
                clearButton.style.display = "none";
                saveBtn.disabled = true;

                saveBtn.title = "Agrega productos para poder guardar";
                renderSavedComparisons();
                return;
            }

            clearButton.style.display = "inline-block";
            saveBtn.disabled = false;
            saveBtn.title = "Guardar esta comparación";

            const features = [
                {key: "name", label: "Nombre del Modelo", type: "product-title"},
                {
                    key: "price",
                    label: '<i class="fas fa-dollar-sign"></i> Precio IT HYT',
                    type: "price-cell",
                },
                {
                    key: "processor",
                    label:
                        '<i class="fas fa-microchip"></i> Procesador / Espec. Principal',
                    type: "data",
                },

                {
                    key: "ram",
                    label: '<i class="fas fa-memory"></i> Memoria RAM / Conectividad',
                    type: "data",
                },
                {
                    key: "storage",
                    label: '<i class="fas fa-hdd"></i> Almacenamiento / Detalles',
                    type: "data",
                },
                {key: "action", label: "Acción", type: "buy-link"},
            ];

            // Encabezados
            for (let i = 0; i < 4; i++) {
                const th = document.createElement("th");

                if (products[i]) {
                    th.textContent =
                        products[i].name.split(" ").slice(0, 3).join(" ") +
                        (products[i].name.split(" ").length > 3 ? "..." : "");
                } else {
                    th.textContent = "Producto VACÍO";
                }
                tableHeadRow.appendChild(th);
            }

            // Filas
            features.forEach((feature) => {
                const row = document.createElement("tr");
                const featureCell = document.createElement("td");
                featureCell.classList.add("feature-cell");
                featureCell.innerHTML = feature.label;
                row.appendChild(featureCell);

                for (let i = 0; i < 4; i++) {
                    const product = products[i];

                    const td = document.createElement("td");

                    if (product) {
                        if (feature.key === "action") {
                            td.classList.add("buy-link");
                            td.innerHTML = `<a href="#">AÑADIR A CARRITO</a>`;
                        } else {
                            td.classList.add(feature.type);
                            td.innerHTML = product[feature.key] || "-";
                        }
                    } else {
                        td.textContent = feature.key === "name" ? "VACÍO" : "-";
                    }

                    row.appendChild(td);
                }
                tableBody.appendChild(row);
            });

            updateComparisonCounter(products.length);

            // marcar si la comparación actual ya está guardada
            const saved = getSavedComparisons();

            const exists = saved.some(
                (c) => normalizedKey(c.productIds) === normalizedKey(productIds),
            );
            saveBtn.classList.toggle("saved", exists);

            renderSavedComparisons();
        }

        /* ===========================
  
         Guardar/gestionar comparaciones
         =========================== */
        function saveCurrentComparison() {
            const ids = getCurrentComparison().slice(0, 4);
            if (ids.length === 0) return;

            const saved = getSavedComparisons();
            const key = normalizedKey(ids);

            // Evitar duplicados exactos (independiente del orden)
            if (saved.some((c) => normalizedKey(c.productIds) === key)) {
                // ya existe: solo feedback visual
                document.getElementById("save-comparison-btn").classList.add("saved");
                return;
            }

            // límite opcional (10)
            const MAX = 10;
            const newItem = {
                id: String(Date.now()),
                productIds: ids,
                createdAt: new Date().toISOString(),
            };
            const updated = [newItem, ...saved].slice(0, MAX);
            setSavedComparisons(updated);

            document.getElementById("save-comparison-btn").classList.add("saved");
            renderSavedComparisons();
        }

        function deleteSavedComparison(id) {
            const updated = getSavedComparisons().filter((c) => c.id !== id);
            setSavedComparisons(updated);
            renderSavedComparisons();
        }

        function loadSavedComparison(id) {
            const item = getSavedComparisons().find((c) => c.id === id);
            if (!item) return;

            setCurrentComparison(item.productIds);
            loadComparisonTable();
            window.scrollTo({top: 0, behavior: "smooth"});
        }

        function renderSavedComparisons() {
            const container = document.getElementById("saved-grid");
            const empty = document.getElementById("saved-empty");

            const saved = getSavedComparisons();

            container.innerHTML = "";

            empty.style.display = saved.length ? "none" : "block";

            saved.forEach((item) => {
                const names = item.productIds
                    .map((pid) => getProductData(pid)?.name || pid)
                    .slice(0, 4);
                const div = document.createElement("div");
                div.className = "saved-card";
                const created = new Date(item.createdAt);
                div.innerHTML = `
          <div class="meta"><i class="far fa-clock"></i> Guardado el ${created.toLocaleDateString()} ${created.toLocaleTimeString()}</div>
          <div class="names">${names.join(" • ")}</div>
          <div class="actions">
            <button class="btn btn-secondary" onclick="loadSavedComparison('${item.id}')"><i class="fas fa-eye"></i> Ver</button>
            <button class="btn btn-danger" onclick="deleteSavedComparison('${item.id}')"><i class="fas fa-trash-alt"></i> Borrar</button>
          </div>`;
                container.appendChild(div);
            });
        }

        /* ===========================
         Arranque + eventos
         =========================== */
        document.addEventListener("DOMContentLoaded", () => {
            // menú mobile
            const menuToggle = document.querySelector(".menu-toggle");
            const mainMenu = document.getElementById("main-menu");
            if (menuToggle && mainMenu) {
                menuToggle.addEventListener("click", (e) => {
                    e.preventDefault();
                    mainMenu.classList.toggle("open");
                });
            }

            // botón guardar comparación
            document
                .getElementById("save-comparison-btn")
                .addEventListener("click", saveCurrentComparison);

            // popup carrito (igual que en home)
            const popup = document.getElementById("cart-popup");
            const overlay = document.getElementById("cart-popup-overlay");
            const closeBtn = document.getElementById("close-popup-btn");
            function showCartPopup() {
                if (popup && overlay) {
                    overlay.classList.add("show");
                    popup.classList.add("show");
                }
            }

            function hideCartPopup() {
                if (popup && overlay) {
                    overlay.classList.remove("show");
                    popup.classList.remove("show");
                }
            }
            if (closeBtn) closeBtn.addEventListener("click", hideCartPopup);
            if (overlay) overlay.addEventListener("click", hideCartPopup);
            let pageVisits = sessionStorage.getItem("pageVisits");
            let currentVisitCount = pageVisits ? parseInt(pageVisits, 10) : 0;
            currentVisitCount++;
            sessionStorage.setItem("pageVisits", currentVisitCount);

            if (currentVisitCount === 3) {
                setTimeout(showCartPopup, 1500);
            }
        });

        // Cargar tabla al inicio (también está en body onload por redundancia segura)

        function onLoadInit() {
            loadComparisonTable();
        }
    </script>
</body>

</html>
